<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mssm.mapper.GoodsAttributeMapper">

    <!--addGoodsAttribute-->
    <insert id="addGoodsAttribute" parameterType="com.mssm.domain.GoodsAttribute">
        <selectKey keyColumn="id" keyProperty="id" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID();
        </selectKey>
        insert into goodsattribute
        (gid,cid,sid,gname,cname,sname)
        values
        (#{gid},#{cid},#{sid},#{gname},#{cname},#{sname})
    </insert>

    <!--根据商品id 删除商品属性相关信息-->
    <delete id="deleteGoodsAttributeByGId">
        delete from goodsattribute where gid = #{gid}
    </delete>

    <select id="findColorByGId" resultType="com.mssm.domain.Color">
        select distinct cid id, cname name from goodsattribute where gid = #{gid}
    </select>
    <select id="findSizeByGId" resultType="com.mssm.domain.Size">
        select distinct sid id, sname name from goodsattribute where gid = #{gid}
    </select>

    <!--findGoodsAttributeById-->
    <select id="findGoodsAttributeById" resultType="com.mssm.domain.GoodsAttribute">
        select * from goodsattribute where 1=1 and id=#{id}
    </select>

    <select id="findAll" resultType="com.mssm.domain.GoodsAttribute">
        select * from goodsattribute order by gid,cid,sid
    </select>

    <select id="findByGId" resultType="com.mssm.domain.GoodsAttribute">
        select * from goodsattribute where gid = #{gid}
    </select>

    <!--queryGoodsWithStock-->
    <resultMap id="goodsWithStockMap" type="com.mssm.domain.Goods">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="price" column="price"/>
        <result property="status" column="status"/>
        <collection property="attributeList" column="id" ofType="com.mssm.domain.GoodsAttribute"
                    select="com.mssm.mapper.GoodsAttributeMapper.findByGId"></collection>
    </resultMap>
    <select id="queryGoodsWithStock" resultMap="goodsWithStockMap">
        SELECT id, name, price, status
          FROM goods
         WHERE deleted = 0
    </select>

    <!--添加指定商品的一个数量的库存-->
    <update id="plusOne">
        update goodsattribute set stock=stock+1 where id = #{aid}
    </update>

    <!--减指定商品的一个数量的库存-->
    <update id="minusOne">
        update goodsattribute set stock=stock-1 where id = #{aid}
    </update>

    <!--保存指定商品库存-->
    <update id="updateStock" parameterType="com.mssm.domain.GoodsAttribute">
        update goodsattribute set stock=#{stock} where id = #{id}
    </update>

    <!--根据属性id查询属性-->
    <select id="findById" resultType="com.mssm.domain.GoodsAttribute">
        select * from goodsattribute where id = #{id}
    </select>

    <delete id="deleteById">
        delete from goodsattribute where id = #{id}
    </delete>
</mapper>